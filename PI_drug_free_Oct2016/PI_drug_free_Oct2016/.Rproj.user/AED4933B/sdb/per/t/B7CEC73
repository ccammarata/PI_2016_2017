{
    "contents" : "# PI full task analysis\n\nlibrary(foreign)\nlibrary(psych)\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(car)\nlibrary(Rmisc)\nlibrary(gmodels)\nlibrary(\"wesanderson\", lib.loc=\"/Library/Frameworks/R.framework/Versions/3.2/Resources/library\")\n\nsessList <- list(27, 28, 29, 30, 31)#list session nubmers here\nratList <- list(25,28,35,36,46,49,50,53,57,63,64)#list rat number here\nx <- length(sessList)\ny <- length(ratList)\nrowsNeeded <- (x*y)\n\n#to indicate lesion condition of animals\nsapGroup = list(28, 36,50,63,64)\nconGroup = list(25,35,46,49,53,57)\n\nsummary <- matrix(data = NA, nrow = rowsNeeded, ncol=5)\ncolnames(summary)<- c('ratID', 'session', 'AB_acc', 'AC_acc', 'DE_acc')\ncriteriaOverview <- matrix(data = NA, nrow = rowsNeeded, ncol=2)\n\ni = 1\nfor (sessNum in sessList){\n  for (rat in ratList) {\n    filename <- paste(\"U3_\",rat,\"_\",sessNum,\".csv\", sep=\"\")\n    criteriaFilename <- paste(\"U3_CriteriaMet\",rat,\"_\",sessNum,\".csv\", sep=\"\")\n    print(filename)\n    currentData <- read.csv(filename, header=TRUE, sep=\"\\t\")\n    currentData$resp2 <- ifelse(currentData$Response == \"correct\", 1,0)\n    currentAB <- subset(currentData, trialType == \"AB\")\n    ABacc <- mean(currentAB$resp2)\n    currentDE <- subset(currentData, trialType == \"DE\")\n    DEacc <- mean(currentDE$resp2)\n    currentAC <- subset(currentData, trialType == \"CA\")\n    ACacc <- mean(currentAC$resp2)\n    #sliding window criteria?\n    summary[i,0:5] <- c(rat, sessNum, ABacc, ACacc, DEacc)\n    #criteriaCurrentFile\n    i=i+1\n\n  }\n}\n\n\n#prepare wide and long form data frames\nfinalSummaryW <- data.frame(summary)\nfinalSummaryW$id <- finalSummaryW$rat\nfinalSummaryW$condition <- ifelse(is.element(finalSummaryW$ratID, sapGroup) ,'sap','control')\n\n\nz = rowsNeeded*3 \nfinalSummaryL <- reshape(finalSummaryW, varying = c('AB_acc', 'AC_acc', 'DE_acc'), v.names=\"accuracy\",\ntimevar='trialType',times=c('AB', 'CA', 'DE'), new.row.names=1:z, direction = 'long')\n\n#data analysis\nsummaryTable <- aggregate(accuracy~trialType+session+condition, data=finalSummaryL, FUN=(mean))\ntempTable <- aggregate(accuracy~trialType+session, data=finalSummaryL, FUN=(sd))\nsummaryTable<- as.data.frame(summaryTable)\nsummaryTable$sd <- tempTable$accuracy*100\ntempTable$accuracy <- tempTable$accuracy/sqrt(y)\nsummaryTable$se <- tempTable$accuracy*100\nsummaryTable$accuracy <- summaryTable$accuracy * 100\n\nfinalSummaryW$AB_CA_diff <- finalSummaryW$AB_acc - finalSummaryW$AC_acc\nfinalSummaryW$DE_CA_diff <- finalSummaryW$DE_acc - finalSummaryW$AC_acc\nfinalSummaryW$AB_DE_diff <- finalSummaryW$AB_acc - finalSummaryW$DE_acc\n\n\n#plotting all together\nfinalSummaryL$session <- as.factor(finalSummaryL$session)\nlibrary(ggplot2)\nlibrary(\"RColorBrewer\", lib.loc=\"/Library/Frameworks/R.framework/Versions/3.2/Resources/library\")\nggplot(summaryTable, aes(x=session, y=accuracy, fill=trialType)) + \n  geom_bar(stat=\"identity\", color=\"black\", \n           position=position_dodge()) +\n  #geom_errorbar(aes(ymin=accuracy-se, ymax=accuracy+se), width=.2,\n                #position=position_dodge(.9)) +\n  scale_fill_brewer(palette = \"Dark2\")\n\n#plotting seperated by condition\nlibrary(ggplot2)\nlibrary(\"RColorBrewer\", lib.loc=\"/Library/Frameworks/R.framework/Versions/3.2/Resources/library\")\nggplot(summaryTable, aes(x=session, y=accuracy, fill=trialType)) + \n  geom_bar(stat=\"identity\", color=\"black\", \n           position=position_dodge()) +\n  geom_errorbar(aes(ymin=accuracy-se, ymax=accuracy+se), width=.2,\n                position=position_dodge(.9)) +\n  scale_fill_manual(values=wes_palette(\"Royal1\"))+\n  facet_grid(~condition)+\n  ggtitle(\"PI accuracy with SEM error bars\")\n\n#inferential stats\n#mixed ANOVA 3X5X2 trial type by accuracy by lesion type\n\n\n#repeated measures ANOVA 3x5 for trial type X accuracy within each group\nfinalSummaryL$ratID <- as.factor(finalSummaryL$ratID)\nfinalSummaryL_AC_DE_only <- subset(finalSummaryL, trialType != \"AB\")\n# \n# #mixed anova\n# anovaBetween <- aov(accuracy~condition*trialType*session + Error(ratID/(trialType*session))+condition, data=finalSummaryL_AC_DE_only)\n# summary(anovaBetween)\n# \n# #within ANOVa for sap rats only\n# sapL <- subset(finalSummaryL_AC_DE_only, condition=\"sap\")\n# anovaWithinSap <- aov(accuracy~trialType*session +Error(ratID/(trialType*session)), data=sapL)\n# summary(anovaWithinSap)\n# \n# #within ANOVA for con rats only\n# conL <- subset(finalSummaryL_AC_DE_only, condition=\"con\")\n# anovaWithinCon <- aov(accuracy~trialType*session +Error(ratID/(trialType*session)), data=conL)\n# summary(anovaWithinCon)\n# \n# \n# #anova or trialType by condition\n# model1 <- lm(cbind(AB_acc, AC_acc, DE_acc) ~ condition, data = finalSummaryW)\n# TrialType <- factor(rep(1:3))\n# idata <- data.frame(TrialType)\n# test <- Anova(model1, idata=idata, idesign = ~TrialType, type=3)\n# summary(test, multivariate = FALSE)\n# finalSummaryW$session <- as.factor(finalSummaryW$session)\n# \n# model2 <- lm(cbind(AB_acc, AC_acc, DE_acc) ~ session, data = finalSummaryW)\n# TrialType <- factor(rep(1:3))\n# idata <- data.frame(TrialType)\n# test <- Anova(model2, idata=idata, idesign = ~TrialType, type=3)\n# summary(test, multivariate = FALSE)\n# \n# #to do two within subjects factors need to add columns to wide format so that there's trialtypeXsession\n# #then need to include all those levels in the model and make a factor for each\n# \n# model <- lm(cbind(recall_10, recall_11, recall_20, recall_21, recall_30, recall_31) ~\n#               1, data = rcwide)\n# # generate factor design matrix\n# stimulus <- factor(rep(1:3, each = 2))\n# drunk <- factor(rep(0:1, times = 3))\n# idata <- data.frame(stimulus, drunk)\n# # run ws ANOVA using the Anova command in package car\n# test <- Anova(model, idata = idata, idesign = ~stimulus * drunk, type = 3)",
    "created" : 1478180708059.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2874558243",
    "id" : "B7CEC73",
    "lastKnownWriteTime" : 1478180869,
    "path" : "~/Box Sync/PhD/Code_and_analysis/PI_drug_free_Oct2016 (cmc495@cornell.edu)/PI_analysis.R",
    "project_path" : "PI_analysis.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}